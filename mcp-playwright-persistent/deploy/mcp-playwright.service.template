[Unit]
Description=MCP Playwright Persistent Server (SSE Transport)
After=network.target
Documentation=https://github.com/cooneycw/claude-power-pack

[Service]
Type=simple
User=${SERVICE_USER}
WorkingDirectory=${MCP_SERVER_DIR}

# Load environment variables from .env file (if exists)
EnvironmentFile=-${MCP_SERVER_DIR}/.env

# Explicit port configuration
Environment="SERVER_PORT=8081"
Environment="SERVER_HOST=127.0.0.1"

# Use conda run to execute in the correct environment
ExecStart=${CONDA_BIN}/conda run -n mcp-playwright --no-capture-output python ${MCP_SERVER_DIR}/src/server.py

# Restart policy
Restart=on-failure
RestartSec=10s
StartLimitBurst=5
StartLimitIntervalSec=300

# Logging
StandardOutput=journal
StandardError=journal
SyslogIdentifier=mcp-playwright

# Security hardening
NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=strict
ProtectHome=read-only
ReadWritePaths=${MCP_SERVER_DIR}

[Install]
WantedBy=multi-user.target
